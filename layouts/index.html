<!DOCTYPE html>
<html lang="{{ with site.LanguageCode }}{{ . }}{{ else }}en-US{{ end }}">

	<head>
		{{- $isProd := hugo.IsProduction -}}
		{{ partial "head.html" . }}

		<!-- Plausible Analytics - remplace Google Analytics -->
		{{ partial "plausible_head.html" . }}
		<script>
			// Custom Goal for Plausible
			function download() {
				plausible('download');
			};
		</script>

		<!-- Bootstrap from hugo module -->
		<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

	</head>

	<body>
		<div class="container">

			{{ partial "header.html" . }}

			<!--
				Init le dict des divers axes
			-->
			{{ $circuits := dict }}
			{{ $years    := dict }}
			{{ $titles   := dict }}
			{{ $venues   := dict }}
			{{ $cities   := dict }}




			{{ range $.Site.Data.items.items }}
				{{ if .circuit }}
					{{ $temp := dict .circuit 0 }}
					{{ $circuits_new := merge $circuits $temp }}
					{{ $circuits = $circuits_new }}
				{{ end }}

				{{ if .year }}
					{{ $temp := dict .year 0 }}
					{{ $years_new := merge $years $temp }}
					{{ $years = $years_new }}
				{{ end }}

				{{ if .title }}
					{{ $temp := dict .title 0 }}
					{{ $titles_new := merge $titles $temp }}
					{{ $titles = $titles_new }}
				{{ end }}

				{{ if .city }}
					{{ $temp := dict .city 0 }}
					{{ $cities_new := merge $cities $temp }}
					{{ $cities = $cities_new }}
				{{ end }}

				{{ if .venue }}
					{{ $temp := dict .venue 0 }}
					{{ $venues_new := merge $venues $temp }}
					{{ $venues = $venues_new }}
				{{ end }}
			{{ end }}

			<!-- +1 au nombre actuel de videos pour ce tag -->
			{{ range $.Site.Data.items.items }}
				{{ if .circuit }}
					{{ $count := index $circuits .circuit }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .circuit $count }}
					{{ $circuits_new := merge $circuits $temp }}
					{{ $circuits = $circuits_new }}
				{{ end }}

				{{ if .year }}
					{{ $count := index $years .year }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .year $count }}
					{{ $years_new := merge $years $temp }}
					{{ $years = $years_new }}
				{{ end }}

				{{ if .title }}
					{{ $count := index $titles .title }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .title $count }}
					{{ $titles_new := merge $titles $temp }}
					{{ $titles = $titles_new }}
				{{ end }}

				{{ if .city }}
					{{ $count := index $cities .city }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .city $count }}
					{{ $cities_new := merge $cities $temp }}
					{{ $cities = $cities_new }}
				{{ end }}

				{{ if .venue }}
					{{ $count := index $venues .venue }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .venue $count }}
					{{ $venues_new := merge $venues $temp }}
					{{ $venues = $venues_new }}
				{{ end }}

			{{ end }}

			<a id="top"></a>
			<div class="tags">
				<h2>Catégories de vidéos</h2>
				<!-- Affiche les tags -->
				{{- partial "button-category" (dict "types" $circuits "style" "success") }}
				{{- partial "button-category" (dict "types" $years 	  "style" "info") }}
				{{- partial "button-category" (dict "types" $titles   "style" "warning") }}
				{{- partial "button-category" (dict "types" $cities   "style" "danger") }}
				{{- partial "button-category" (dict "types" $venues   "style" "secondary") }}
			</div>

			<!-- Show all zones -->
			{{- partial "video-unit" (dict "context" $ "type" "circuit" "types" $circuits "style" "success") }}
			{{- partial "video-unit" (dict "context" $ "type" "year"    "types" $years    "style" "info") }}
			{{- partial "video-unit" (dict "context" $ "type" "title"   "types" $titles   "style" "warning") }}
			{{- partial "video-unit" (dict "context" $ "type" "city"    "types" $cities   "style" "danger") }}
			{{- partial "video-unit" (dict "context" $ "type" "venue"   "types" $venues   "style" "secondary") }}

			{{ partial "footer.html" . }}

		</div>
		{{ partial "scripts.html" . }}
	</body>
</html>

<!--

	####  Factorise via Inline Partials  ####

-->

<!--
	Affiche les boutons des catégories
	Paramètre : (dict "types" $circuits "style" "success")
-->
{{- define "partials/button-category" }}
	{{- $style := .style }}
	{{- range $k, $i := .types }}
		<a href="#{{ $k }}" role="button" class="btn btn-sm btn-{{ $style }}">
			{{ $k }} <span class="badge badge-light">{{ $i }}</span>
		</a>
	{{- end }}
{{- end }}

<!--
	Affiche les vidéos indiviuelles
	Paramètre : (dict context $ "type" "circuit" "types" $circuits "style" "success")
-->
{{- define "partials/video-unit" }}
	{{- $type  := .type }}
	{{- $types := .types }}
	{{- $style := .style }}

	{{ range $k, $i := $types }}
		<!-- Show videos for this specific circuit -->
		<a id="{{ $k }}"></a>
		<div class="main">
			<h2 class="zvideo alert alert-{{ $style }}">
				{{ $type | humanize }} : {{ $k }} <span class="badge badge-pill badge-light badge-{{ $style }}">{{ $i }}</span>
				<a href="#top" role="button" class="btn btn-{{ $style }} btn-sm float-right">&#x2191;Retour aux choix de catégories</a>
			</h2>
			<ul id="og-grid" class="og-grid">
				{{ range where $.context.Site.Data.items.items $type $k}}
				<li>
						<a href="{{.url}}"
							onclick="download()"
							data-largesrc="{{.image}}"
							data-title="{{.title}} / {{ .episode }}"
							data-description="{{ .description }} ({{ .year }}) {{ with .venue }}- {{ . }}{{ end }} {{ with .city }}- {{ . }}{{ end }}"
							data-buttontext="{{.buttontext}}">

							<img src="{{.thumb}}" alt="{{.alt}}"/>
						</a>
						<p>
							<strong>{{ .title }}</strong>
							<br>
							<em>{{ .episode }}</em>
						</p>
				</li>
				{{ end }}
			</ul>
		</div>
		<!-- End Video -->
	{{ end }}
{{- end }}
<!-- End partial -->
