<!DOCTYPE html>
<html lang="{{ with site.LanguageCode }}{{ . }}{{ else }}en-US{{ end }}">

	<head>
		{{- $isProd := hugo.IsProduction -}}
		{{ partial "head.html" . }}

		<!-- Plausible Analytics - remplace Google Analytics -->
		{{ partial "plausible_head.html" . }}

		<!-- Bootstrap from hugo module -->
		<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

		<!-- Custom Goal for Plausible -->
		<script>
			function download() {
				plausible('download');
			}
		</script>
	</head>

	<body>
		<div class="container">

			{{ partial "header.html" . }}

			<!--
				Init le dict des circuits
			-->
			{{ $circuits := dict }}
			{{ $years := dict }}
			{{ $titles := dict }}

			{{ range $.Site.Data.items.items }}
				{{ if .circuit }}
					{{ $temp := dict .circuit 0 }}
					{{ $circuits_new := merge $circuits $temp }}
					{{ $circuits = $circuits_new }}
				{{ end }}

				{{ if .year }}
					{{ $temp := dict .year 0 }}
					{{ $years_new := merge $years $temp }}
					{{ $years = $years_new }}
				{{ end }}

				{{ if .title }}
					{{ $temp := dict .title 0 }}
					{{ $titles_new := merge $titles $temp }}
					{{ $titles = $titles_new }}
				{{ end }}
			{{ end }}

			<!-- +1 au nombre actuel de videos pour ce tag -->
			{{ range $.Site.Data.items.items }}
				{{ if .circuit }}
					{{ $count := index $circuits .circuit }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .circuit $count }}
					{{ $circuits_new := merge $circuits $temp }}
					{{ $circuits = $circuits_new }}
				{{ end }}

				{{ if .year }}
					{{ $count := index $years .year }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .year $count }}
					{{ $years_new := merge $years $temp }}
					{{ $years = $years_new }}
				{{ end }}

				{{ if .title }}
					{{ $count := index $titles .title }}
					{{ $count := add $count 1 }}
					{{ $temp := dict .title $count }}
					{{ $titles_new := merge $titles $temp }}
					{{ $titles = $titles_new }}
				{{ end }}
			{{ end }}

			<!--
				Affiche les tags
			-->
			<a id="top"></a>

			<div class="tags">
				<h2>Catégories de vidéos</h2>
				{{ range $k, $i := $circuits }}
					<a href="#{{ $k }}" role="button" class="btn btn-success">
						{{ $k }} <span class="badge badge-light">{{ $i }}</span>
					</a>
				{{ end }}
				<br>
				{{ range $k, $i := $years }}
					<a href="#{{ $k }}" role="button" class="btn btn-info">
						{{ $k }} <span class="badge badge-light">{{ $i }}</span>
					</a>
				{{ end }}
				<br>
				{{ range $k, $i := $titles }}
					<a href="#{{ $k }}" role="button" class="btn btn-warning">
						{{ $k }} <span class="badge badge-light">{{ $i }}</span>
					</a>
				{{ end }}
			</div>

			<!--
				CIRCUITS
				Show zones for all circuits
			-->
			{{ range $k, $i := $circuits }}
				<!-- Show videos for this specific circuit -->
				<a id="{{ $k }}"></a>
				<div class="main">
					<h2 class="zvideo alert alert-success">
						Circuit : {{ $k }}
						<a href="#top" role="button" class="btn btn-success btn-sm float-right">&#x2191;Retour aux choix de catégories</a>
					</h2>
					<ul id="og-grid" class="og-grid">
						{{ range where $.Site.Data.items.items "circuit" $k}}
						<li>
							<a href="{{.url}}"
								onclick="download()"
								data-largesrc="{{.image}}"
								data-title="{{.title}} / {{ .episode }}"
								data-description="{{.description }} ({{.year }})"
								data-buttontext="{{.buttontext}}">

								<img src="{{.thumb}}" alt="{{.alt}}"/>
							</a>
							<p>
								<strong>{{ .title }}</strong>
								<br>
								<em>{{ .episode }}</em>
							</p>
						</li>
						{{ end }}
					</ul>
				</div>
				<!-- End Video -->
			{{ end }}
			<!-- FIN boucle circuits -->

			<!--
				YEARS
				Show zones for all years
			-->
			{{ range $k, $i := $years }}
				<!-- Show videos for this specific circuit -->
				<a id="{{ $k }}"></a>
				<div class="main">
					<h2 class="zvideo alert alert-info">
						Année : {{ $k }}
						<a href="#top" role="button" class="btn btn-info btn-sm float-right">&#x2191;Retour aux choix de catégories</a>
					</h2>
					<ul id="og-grid" class="og-grid">
						{{ range where $.Site.Data.items.items "year" $k}}
						<li>
							<a href="{{.url}}"
								onclick="download()"
								data-largesrc="{{.image}}"
								data-title="{{.title}} / {{ .episode }}"
								data-description="{{.description }} ({{.year }})"
								data-buttontext="{{.buttontext}}">

								<img src="{{.thumb}}" alt="{{.alt}}"/>
							</a>
							<p>
								<strong>{{ .title }}</strong>
								<br>
								<em>{{ .episode }}</em>
							</p>
						</li>
						{{ end }}
					</ul>
				</div>
				<!-- End Video -->
			{{ end }}
			<!-- FIN boucle YEARS -->

			<!--
				TITLES
				Show zones for all titles
			-->
			{{ range $k, $i := $titles }}
				<!-- Show videos for this specific circuit -->
				<a id="{{ $k }}"></a>
				<div class="main">
					<h2 class="zvideo alert alert-warning">
						Saison : {{ $k }}
						<a href="#top" role="button" class="btn btn-warning btn-sm float-right">&#x2191;Retour aux choix de catégories</a>
					</h2>
					<ul id="og-grid" class="og-grid">
						{{ range where $.Site.Data.items.items "title" $k}}
						<li>
							<a href="{{.url}}"
								onclick="download()"
								data-largesrc="{{.image}}"
								data-title="{{.title}} / {{ .episode }}"
								data-description="{{.description }} ({{.year }})"
								data-buttontext="{{.buttontext}}">

								<img src="{{.thumb}}" alt="{{.alt}}"/>
							</a>
							<p>
								<strong>{{ .title }}</strong>
								<br>
								<em>{{ .episode }}</em>
							</p>
						</li>
						{{ end }}
					</ul>
				</div>
				<!-- End Video -->
			{{ end }}
			<!-- FIN boucle circuits -->

			{{ partial "footer.html" . }}

		</div>
		{{ partial "scripts.html" . }}
	</body>
</html>
